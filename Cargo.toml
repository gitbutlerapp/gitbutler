[workspace]
members = [
    # What follows is an attempt at crate classification.
    # Moving them up is the goal here.
    # And of course, this classification isn't truly objective,
    # and you should feel free to make adjustments.
    ##
    ### âœ…Exemplary ğŸ†
    ##
    # Exhaustive documentation (via `#![deny(missing_docs)]`)
    # Exhaustive tests
    # No or minimal 'legacy' support
    # No `but-ctx` dependency
    # ideally: idiomatic Rust
    "crates/but-core",             # ğŸ“„Core types and capabilities, a catch all that could be split into smaller crates.
    "crates/but-graph",            # ğŸ“„The world of GitButler, classification and analysis of commit-graphs.
    "crates/but-ctx",              # ğŸ“„Re-use of caches and db-connections, access to all data one would need to be GitButler.
    "crates/but-db",               # ğŸ“„Abstractions over Sqlite databases and Caches, with transaction and synchronization support.
    "crates/but-error",            # ğŸ“„Error codes to communicate specific failures; JSON Error for frontends.
    "crates/but-testsupport",      # ğŸ“„Despite lacking tests, it is the foundation for all tests.
    "crates/but-feedback",         # ğŸ“„It's very small and very special, but documented and well-enough tested.

    ##
    ### ğŸ‘·Needs work
    ##
    # Shows many or all traits of Exemplary
    # Substantial legacy code or legacy dependencies
    # Partial or incomplete documentation.
    # Tests for core capabilities.
    # ğŸ‘‰Could be exemplary once older supporting code is removed, and it was actually reviewed.
    "crates/but-rebase",            # ğŸ“„Alter commit-graphs in various ways
    # ğŸ‘‰needs impl based on `but_core::snapshot`; shouldn't use `but-ctx`.
    "crates/but-oplog",             # ğŸ“„A sketch of a modern `gitbutler-oplog`
    # ğŸ‘‰mostly powered by legacy, but will help to transition to `but-db` backing.
    "crates/but-meta",              # ğŸ“„An interface to support Git-entity metadata;
    # ğŸ‘‰lacks tests
    "crates/but-hunk-assignment",   # ğŸ“„Assign uncommitted changes to stacks/lanes.
    # ğŸ‘‰uses `but-ctx`.
    "crates/but-hunk-dependency",   # ğŸ“„Assuming it works, it feels close to 'Exemplary',
    # ğŸ‘‰Too much legacy code.
    "crates/but-workspace",         # ğŸ“„Workspace abstractions on top of `but-graph`; workspace manipulation.
    # ğŸ‘‰lacks tests, overview in docs, seems hacky. Uses `but-ctx`.
    "crates/but-claude",            # ğŸ“„Orchestrate `claude` instances
    # ğŸ‘‰but at least one item lacks documentation.
    "crates/but-path",              # ğŸ“„Provide paths interesting to the application, with global redirects for testing.
    # ğŸ‘‰Lacks docs and tests, and overview, but still useful and simple enough to 'just works'
    "crates/but-serde",             # ğŸ“„Serde attributes for ser-de of custom datatypes.
    # ğŸ‘‰Lacks docs and tests. Centralized simple utility schema generation modules.
    "crates/but-schemars",          # ğŸ“„`schemars` json schema generation utilities.
    # ğŸ‘‰Feels overengingeered, uses `but-ctx` and legacy crates.
    "crates/but-worktrees",         # ğŸ“„Worktree creation and removal;
    # ğŸ‘‰Could be exemplary after review.
    "crates/but-update",            # ğŸ“„Retrieve information about available program versions to guide updates.
    # ğŸ‘‰Lacks top-level docs and tests; uses legacy features
    "crates/but-rules",             # ğŸ“„Decide what to do when files change in the worktree
    # ğŸ‘‰Unclear purpose (a mix of everything?); lacks tests and docs. Uses legacy crates (a lot).
    "crates/but-action",            # ğŸ“„TBD
    # ğŸ‘‰Unclear purpose; lacks docs and tests. Uses legacy crate.
    "crates/but-bot",               # ğŸ“„TBD
    # ğŸ‘‰Unclear purpose (a mix of everything?); lacks tests and docs. Uses legacy crates (a lot).
    "crates/but-tools",             # ğŸ“„TBD
    # ğŸ‘‰No tests, lacks top-level docs, purpose somewhat unclear.
    "crates/but-llm",               # ğŸ“„TBD
    # ğŸ‘‰lacks top-level docs and docs.
    "crates/but-github",            # ğŸ“„A thin wrapper of the GitHub API, for authentication and resource access.
    # ğŸ‘‰lacks top-level docs and docs.
    "crates/but-gitlab",            # ğŸ“„A thin wrapper of the GitLab API, for authentication and resource access.
    # ğŸ‘‰No tests, lacks top-level docs, purpose somewhat unclear.
    "crates/but-cursor",            # ğŸ“„Integration with Cursor
    # ğŸ‘‰Kind of no docs, no tests, and unclear purpose.
    "crates/but-forge",             # ğŸ“„A generalised interface to communicate with forges.
    # ğŸ‘‰Kind of no docs, no tests, and unclear purpose. Does this need to be its own crate?
    "crates/but-forge-storage",     # ğŸ“„TBD
    # ğŸ‘‰No documentation; some tests. Uses one legacy crate.
    "crates/but-gerrit",            # ğŸ“„Interaction with Gerrit
    # ğŸ‘‰Might be exemplary if it was fully documented.
    "crates/but-secret",            # ğŸ“„Retrieve and store secrets in the platform keychain.
    # ğŸ‘‰Might be exemplary if it was fully documented.
    "crates/but-settings",          # ğŸ“„Store and retrieve layered application settings, react to changes in realtime.
    # ğŸ‘‰Has tests, but leans heavily on legacy crates.
    "crates/but-cherry-apply",      # ğŸ“„Apply commits to different stacks.

    ##
    ### Soon obsolete
    ##
    # Mostly supporting legacy code.
    # In big parts replaced by other crates.
    "crates/but-fs",                # ğŸ“„filesystem utilities ğŸ‘‰we should be using `but-db` instead.
    "crates/but-status",            # ğŸ“„One crate for `create_wd_tree()` which no modern code uses anymore.
    "crates/but-oxidize",           # ğŸ“„Utilities to help translate between `git2` and `gix`. ğŸ‘‰Shouldn't be needed once `git2` is gone.

    ##
    ### but-api - it's very own thing
    ##
    # Has no tests (yet)
    # A lot of legacy functions that need porting
    # the non-legacy code should be matching Exemplary standards of documentation
    "crates/but-api",               # ğŸ“„A project-based API to used by all clients (CLI, GUI, etc)
    "crates/but-api-macros",        # ğŸ“„A utility to generate exactly the code we need in the `but-api`.

    ##
    ### Binaries
    ##
    # Strive for testing main functionality and journeys where applicable.
    "crates/but",
    # Should be functionally equivalent to `gitbutler-tauri`
    "crates/but-server",
    # Should be reviewed to mostly use `but-api`, to be renamed to `but-tauri` or something.
    "crates/gitbutler-tauri",
    # Hack at will. Can be of any quality level, as long as it works for you.
    "crates/but-testing",
    # GitButler installation binary
    "crates/but-installer",
    # Documentation binary
    "crates/but-clap",

    ##
    ### Utilities
    ##
    # Generate TypeScript types out of JSON schemas.
    "crates/but-ts",
    # Node.js SDK via napi-rs
    "crates/but-napi",
    "crates/but-debugging",


    ##
    ### Legacy
    ##
    # Crates that are from the first version of GitButler, using old data structures.
    # To be removed and ported.
    "crates/gitbutler-*",
]
resolver = "2"

[workspace.package]
repository = "https://github.com/gitbutlerapp/gitbutler"
authors = ["GitButler <gitbutler@gitbutler.com>"]
edition = "2024"
rust-version = "1.89"

[workspace.dependencies]
but = { path = "crates/but" }
but-debugging = { path = "crates/but-debugging" }
but-testsupport = { path = "crates/but-testsupport" }
but-rebase = { path = "crates/but-rebase" }
but-core = { path = "crates/but-core" }
but-ctx = { path = "crates/but-ctx" }
but-workspace = { path = "crates/but-workspace" }
but-hunk-assignment = { path = "crates/but-hunk-assignment" }
but-hunk-dependency = { path = "crates/but-hunk-dependency" }
but-worktrees = { path = "crates/but-worktrees" }
but-db = { path = "crates/but-db" }
but-path = { path = "crates/but-path" }
but-graph = { path = "crates/but-graph" }
but-meta = { path = "crates/but-meta" }
but-rules = { path = "crates/but-rules" }
but-action = { path = "crates/but-action" }
but-bot = { path = "crates/but-bot" }
but-status = { path = "crates/but-status" }
but-tools = { path = "crates/but-tools" }
but-api = { path = "crates/but-api" }
but-api-macros = { path = "crates/but-api-macros" }
but-claude = { path = "crates/but-claude" }
but-cursor = { path = "crates/but-cursor" }
but-gerrit = { path = "crates/but-gerrit" }
but-cherry-apply = { path = "crates/but-cherry-apply" }
but-github = { path = "crates/but-github" }
but-gitlab = { path = "crates/but-gitlab" }
but-error = { path = "crates/but-error" }
but-serde = { path = "crates/but-serde" }
but-schemars = { path = "crates/but-schemars" }
but-update = { path = "crates/but-update" }
but-installer = { path = "crates/but-installer" }
but-secret = { path = "crates/but-secret" }
but-feedback = { path = "crates/but-feedback" }
but-forge-storage = { path = "crates/but-forge-storage" }
but-settings = { path = "crates/but-settings" }
but-oxidize = { path = "crates/but-oxidize" }
but-fs = { path = "crates/but-fs" }
but-forge = { path = "crates/but-forge" }
but-oplog = { path = "crates/but-oplog" }
but-llm = { path = "crates/but-llm" }

gitbutler-git = { path = "crates/gitbutler-git" }
gitbutler-watcher = { path = "crates/gitbutler-watcher" }
gitbutler-filemonitor = { path = "crates/gitbutler-filemonitor" }
gitbutler-testsupport = { path = "crates/gitbutler-testsupport" }
gitbutler-branch-actions = { path = "crates/gitbutler-branch-actions" }
gitbutler-oplog = { path = "crates/gitbutler-oplog" }
gitbutler-repo = { path = "crates/gitbutler-repo" }
gitbutler-repo-actions = { path = "crates/gitbutler-repo-actions" }
gitbutler-project = { path = "crates/gitbutler-project" }
gitbutler-user = { path = "crates/gitbutler-user" }
gitbutler-branch = { path = "crates/gitbutler-branch" }
gitbutler-reference = { path = "crates/gitbutler-reference" }
gitbutler-commit = { path = "crates/gitbutler-commit" }
gitbutler-url = { path = "crates/gitbutler-url" }
gitbutler-operating-modes = { path = "crates/gitbutler-operating-modes" }
gitbutler-edit-mode = { path = "crates/gitbutler-edit-mode" }
gitbutler-cherry-pick = { path = "crates/gitbutler-cherry-pick" }
gitbutler-stack = { path = "crates/gitbutler-stack" }
gitbutler-workspace = { path = "crates/gitbutler-workspace" }

# Bundled rusqlite for Windows.
# TODO: is 'bundled' still needed?
rusqlite = { version = "0.38.0", features = ["bundled"] }
backoff = "0.4.0"
bstr = "1.12.1"
# Add the `tracing` or `tracing-detail` features to see more of gitoxide in the logs. Useful to see which programs it invokes.
gix = { version = "0.79.0", git = "https://github.com/GitoxideLabs/gitoxide", branch = "main", default-features = false, features = [] }
gix-testtools = { version = "0.18.0", git = "https://github.com/GitoxideLabs/gitoxide", branch = "main" }

ts-rs = { version = "11.1.0", features = ["serde-compat", "no-serde-warnings"] }
insta = { version = "1.45.1", features = ["json"] }
git2 = { version = "0.20.4", features = [
    "vendored-openssl",
    "vendored-libgit2",
] }
uuid = { version = "1.20", features = ["v4", "serde"] }
serde = { version = "1.0", features = ["derive", "std"] }
serde_json = "1.0.148"
thiserror = "2.0.17"
tokio = { version = "1.49.0", default-features = false }
keyring = { version = "3.6.3", features = [
    "apple-native",
    "windows-native",
    "linux-native-sync-persistent",
    "crypto-rust",
] }
anyhow = "1.0.100"
parking_lot = "0.12.4"
futures = "0.3.31"
toml = "0.9.10"
tracing = "0.1.44"
tracing-subscriber = "0.3.22"
tempfile = "3.24"
rand = "0.9.2"
notify-rust = "4.11.7"
git2-hooks = { version = "0.5.0" }
itertools = "0.14.0"
dirs = "6.0.0"
rmcp = { version = "0.9.1", default-features = false, features = [
    "base64",
    "server",
    "macros",
] }
serde_json_lenient = "0.2.3"
reqwest = { version = "0.12.28", default-features = false, features = [
    "rustls-tls",
    "json",
] }
chrono = { version = "0.4.42", default-features = false, features = ["std"] }
md5 = "0.8.0"
sha2 = "0.10"
bitflags = "2.9.4"
notify = "8.2.0"
snapbox = "0.6.23"
url = "2.5.7"
petgraph = { version = "0.8.3", default-features = false, features = [
    "stable_graph",
    "std",
] }

schemars = { version = "1.2.0", default-features = false, features = [
    "std",
    "derive",
] }
async-openai = { version = "0.31.1", default-features = false, features = [
    "rustls",
    "chat-completion",
] }
open = "5.3.2"
regex = { version = "1.11.3", default-features = false, features = [
    "std",
    "unicode",
] }
clap = { version = "4.5.54", default-features = false, features = [
    "derive",
    "std",
    "help",
    "unstable-markdown",
] }
tracing-forest = { version = "0.3.0" }
sysinfo = { version = "0.37.2", default-features = false }
shell-words = "1.1.1"
nonempty = "0.12.0"
ratatui = "0.30"
crossterm = "0.28"
self_cell = "1.2.2"
unicode-segmentation = "1.12.0"

[workspace.lints.clippy]
all = "deny"
# Note that `all` doesn't include everything, so extra lints should be added here.
# You can try `pedantic = deny` to see those extra lints (alongside `all`).
uninlined_format_args = "deny"

[profile.release]
# There are no overrides here as we optimise for fast release builds,
# which are used when building locally and when making Nightly builds.
# The Stable release builds override the relevant settings at release time
# to optimise for size.

[profile.bench]
codegen-units = 256
lto = false
opt-level = 3
debug = "line-tables-only"

[profile.dev]
incremental = false
debug = "line-tables-only"

[profile.test]
incremental = false

# Assure that `gix` is always fast so debug builds aren't unnecessarily slow.
[profile.dev.package]
foldhash = { opt-level = 3 }
imara-diff = { opt-level = 3 }
but-graph = { opt-level = 3 }
gix = { opt-level = 3 }
gix-diff = { opt-level = 3 }
gix-object = { opt-level = 3 }
gix-ref = { opt-level = 3 }
gix-pack = { opt-level = 3 }
gix-hash = { opt-level = 3 }
gix-actor = { opt-level = 3 }
gix-config = { opt-level = 3 }
gix-worktree = { opt-level = 3 }
sha1-checked = { opt-level = 3 }
zlib-rs = { opt-level = 3 }
serde = { opt-level = 3 }
serde_json = { opt-level = 3 }
# This one is special as we can run into debug assertions otherwise.
# They have a time, but let's chose the time instead of always being hit by it.
gix-merge = { opt-level = 3, debug-assertions = false }

[profile.release.package.but-installer]
opt-level = "z" # Optimize for size instead of speed
strip = true    # Strip symbols from binary
