name: 'Test Nix Flake'

on:
  push:
    branches:
      - master
  pull_request:
    paths:
      - 'flake.nix'
      - 'flake.lock'
      - '.github/workflows/test-flake.yml'
      - 'rust-toolchain.toml'
      - '**/Cargo.toml'
      - 'Cargo.lock'

jobs:
  test-flake:
    runs-on: ubuntu-latest
    # This job is not required to pass for PRs to merge
    # It's informational only
    continue-on-error: true
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
        with:
          persist-credentials: false

      - name: Install Nix
        uses: DeterminateSystems/nix-installer-action@v16

      - name: Setup Nix cache
        uses: DeterminateSystems/magic-nix-cache-action@v8

      - name: Check flake
        run: nix flake check --show-trace

      - name: Test dev shell
        run: nix develop --command echo "Dev shell loaded successfully"
